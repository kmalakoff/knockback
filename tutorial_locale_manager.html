<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>Tutorial: Custom Locale Manager</title>
    <link rel="stylesheet" href="vendor/css/normalize.css">
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="vendor/google-code-prettify/prettify.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/layout_components.css">
    <script type="application/javascript" src="vendor/js/jquery-1.8.0.js"></script>
    <link rel="stylesheet" href="css/tutorial.css">
    <script type="application/javascript" src="vendor/globalize/globalize.js"></script>
    <script type="application/javascript" src="vendor/globalize/globalize.culture.en-GB.js"></script>
    <script type="application/javascript" src="vendor/globalize/globalize.culture.fr-FR.js"></script>
    <script type="application/javascript" src="vendor/js/knockback-full-stack-0.16.2.js"></script>
    <script type="application/javascript" src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script type="application/javascript" src="vendor/google-code-prettify/prettify.js"></script>
    <script type="application/javascript" src="js/stylecode.js"></script>
    <script type="application/javascript" src="js/interface.js"></script>
  </head>
  <body>
    <div class="page navbar">
      <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container"><a data-toggle="collapse" data-target=".nav-collapse" class="btn btn-navbar"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a><a href="https://github.com/kmalakoff/knockback" class="brand kb">Knockback.js</a>
            <div class="nav-collapse">
              <ul class="nav">
                <li><a href="index.html">Home</a></li>
                <li><a href="doc/index.html">API</a></li>
                <li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Getting Started<b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li></li><a href="getting_started_introduction.html">Overview</a><a href="getting_started_dependent_library_basics.html">Dependent Library Basics</a><a href="getting_started_knockback_basics.html">Knockback Basics</a><a href="getting_started_views_view_models_models.html">Models, Views, and ViewModels</a><a href="getting_started_memory_lifecycle_management.html">Memory and Lifecycle Management</a><a href="getting_started_knockback_important_details.html">Knockback Important Details</a>
                  </ul>
                </li>
                <li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Components<b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li></li><a href="components_backbone_relational.html">Backbone Relational</a><a href="components_backbone_modelref.html">Backbone ModelRef</a><a href="components_knockback_inspector.html">Knockback Inspector</a><a href="components_knockback_navigators.html">Knockback Navigators</a>
                  </ul>
                </li>
                <li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Applications<b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li></li><a href="app_knockback_reference.html">Knockback Reference App</a><a href="app_todos.html">Todos App</a>
                  </ul>
                </li>
                <li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Tutorials<b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li></li><a href="tutorials_introduction.html">Introduction</a><a href="tutorial_kb_observable.html">kb.Observable</a><a href="tutorial_kb_view_model.html">kb.ViewModel</a><a href="tutorial_kb_collection_observable.html">kb.CollectionObservable</a><a href="tutorial_nested_models.html">Nested Models</a><a href="tutorial_relational_models.html">Relational Models</a><a href="tutorial_kb_localized_observable.html">kb.LocalizedObservable</a><a href="tutorial_locale_manager.html">Custom Locale Manager</a><a href="tutorial_knockback_inspector.html">Knockback Inspector (Advanced)</a>
                  </ul>
                </li>
                <li><a href="https://github.com/kmalakoff/knockback/wiki/Release-Notes">Release Notes</a></li>
              </ul>
              <div id="script_language">
                <div class="separator">
                  <div class="selection codestyle">
                    <div class="option">
                      <input id="cs-cs" type="radio" name="codestyle" value="cs" class="auto"/>
                      <label for="cs-cs">CS</label>
                    </div>
                    <div class="option">
                      <input id="cs-js" type="radio" name="codestyle" value="js"/>
                      <label for="cs-js">JS</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <header class="page">
      </header>
      <content class="page">
        <section>
          <h1>Tutorial: Custom Locale Manager</h1>
          <p><a href="index.html">Knockback.js</a><span> does not provide a Locale Manager implementation since it depends on how you want to store and where you want to manage your localized strings.</span></p>
          <p><span>If you choose to use</span><a href="doc/classes/kb/LocalizedObservable.html"> kb.LocalizedObservable</a><span>, it assumes that you assign your implementation to 'kb.locale_manager'.</span></p>
          <p></p>
          <h3>A Simple Implementation</h3>
          <p><span>Because Knockback actually only requires a</span><a href="docs.html#backbone_model_signature"> Backbone.Model-like signature</a><span>, a custom locale manager can be implemented quite easily. Here is an example:</span></p>
          <pre data-for="cs">class LocaleManager
  constructor: (locale_identifier, @translations_by_locale) ->
    @current_locale = ko.observable(locale_identifier)

  get: (string_id) ->
    return '(no translation)' unless @translations_by_locale[@current_locale()]
    return '(no translation)' unless @translations_by_locale[@current_locale()].hasOwnProperty(string_id)
    return @translations_by_locale[@current_locale()][string_id]

  getLocale: -> return @current_locale()
  setLocale: (locale_identifier) ->
    @current_locale(locale_identifier)
    @trigger('change', @)

_.extend(LocaleManager.prototype, Backbone.Events)</pre>
          <pre data-for="js">var LocaleManager = function(locale_identifier, translations_by_locale) {
  this.translations_by_locale = translations_by_locale;
  this.current_locale = ko.observable(locale_identifier);

  this.get = function(string_id) {
    if (!this.translations_by_locale[this.current_locale()]) { return '(no translation)'; }
    if (!this.translations_by_locale[this.current_locale()].hasOwnProperty(string_id)) { return '(no translation)'; }
    return this.translations_by_locale[this.current_locale()][string_id];
  };

  this.getLocale = function() { return this.current_locale(); };
  this.setLocale = function(locale_identifier) {
    this.current_locale(locale_identifier);
    return this.trigger('change', this);
  };
};

_.extend(LocaleManager.prototype, Backbone.Events);</pre>
          <p><span>In more detail...we create an observable with the current locale so the locale identifier can be displayed:</span>
            <pre data-for="cs">@current_locale = ko.observable(locale_identifier)</pre>
            <pre data-for="js">this.current_locale = ko.observable(locale_identifier);</pre>
          </p>
          <p><span>We create a get() method that is used by ko.observable to listen for changes using Backbone.Events:</span>
            <pre data-for="cs">get: (string_id) -&gt; ...</pre>
            <pre data-for="js">get: function(string_id) {...}</pre>
          </p>
          <p><span>We trigger a Backbone.Events event to notify a subscribed ko.observable</span>
            <pre data-for="cs">setLocale: (locale_identifier) -&gt;
  @current_locale(locale_identifier)
  @trigger('change', @)</pre>
            <pre data-for="js">setLocale: function(locale_identifier) {
  this.current_locale(locale_identifier);
  this.trigger('change', this);
}</pre>
          </p>
          <p><span>We mixin Backbone.Events into our LocaleManager to provide 'bind', 'trigger', and 'unbind':</span>
            <pre data-for="cs">_.extend(LocaleManager.prototype, Backbone.Events)</pre>
            <pre data-for="js">_.extend(LocaleManager.prototype, Backbone.Events);</pre>
          </p>
          <div class="row-fluid">
            <div class="span8">
              <ul class="nav nav-tabs">
                <li class="active"><a href="#lm_simple_view" data-toggle="tab">View (HTML)</a></li>
                <li><a href="#lm_simple_view_model" data-toggle="tab">ViewModel (CS/JS)</a></li>
              </ul>
              <div class="tab-content">
                <div id="lm_simple_view" class="tab-pane active">
                  <pre>&lt;div id='lm_simple'&gt;
  &lt;p&gt;
    &lt;span data-bind=&quot;text: label_name&quot;&gt;&lt;/span&gt;
    &lt;span data-bind=&quot;text: name&quot;&gt;&lt;/span&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;span&gt;Current Locale: &lt;span&gt;
    &lt;span data-bind=&quot;text: simple_locale_manager.getLocale()&quot;&gt;&lt;span&gt;
  &lt;/p&gt;
  &lt;button data-bind=&quot;click: toggleLocale&quot;&gt;Toggle Locale&lt;/button&gt;
&lt;/div&gt;</pre>
                </div>
                <div id="lm_simple_view_model" class="tab-pane">
                  <pre data-for="cs"># create and initialize the locale manager with two languages
simple_locale_manager = new LocaleManager('en', {
  'en':
    name: 'Name: '
  'fr':
    name: 'Nom: '
})

bob = new Backbone.Model({name: 'Bob'})

view_model = kb.viewModel(bob)

# add a localized label for 'name' and a function for toggling the current locale
view_model.label_name = kb.observable(simple_locale_manager, 'name')
view_model.toggleLocale = ->
  if (simple_locale_manager.getLocale() == 'en')
    simple_locale_manager.setLocale('fr')
  else
    simple_locale_manager.setLocale('en')

ko.applyBindings(view_model, $('#lm_simple')[0])</pre>
                  <pre data-for="js">// create and initialize the locale manager with two languages
var simple_locale_manager = new LocaleManager('en', {
  'en': {
    name: 'Name: '
  },
  'fr': {
    name: 'Nom: '
  }
});

var bob = new Backbone.Model({name: 'Bob'});

var view_model = kb.viewModel(bob);

// add a localized label for 'name' and a function for toggling the current locale
view_model.label_name = kb.observable(simple_locale_manager, 'name');
view_model.toggleLocale = function() {
  if (simple_locale_manager.getLocale() === 'en') {
    return simple_locale_manager.setLocale('fr');
  } else {
    return simple_locale_manager.setLocale('en');
  }
};

ko.applyBindings(view_model, $('#lm_simple')[0]);</pre>
                </div>
              </div>
            </div>
            <div class="span4">
              <h4>Live Result</h4>
              <div class="demos_result_box"><div id='lm_simple'>
  <p>
    <span data-bind="text: label_name"></span>
    <span data-bind="text: name"></span>
  </p>

  <p>
    <span>Current Locale: <span>
    <span data-bind="text: simple_locale_manager.getLocale()"><span>
  </p>
  <button data-bind="click: toggleLocale">Toggle Locale</button>
</div>
                <script type="application/javascript" src="tutorials/locale_manager/lm_simple_models.js"></script>
                <script type="application/javascript" src="tutorials/locale_manager/lm_simple_view_model_bindings.js"></script>
              </div>
            </div>
          </div>
          <p></p>
          <h3>An Advanced Implementation</h3>
          <p></p>
          <p><span>To make a more advanced version of the locale manager, you will want to add error checking and might choose to add parameters to the get() function, trigger on each string, and allow to query for all available locales (among other possible enhancements!):</span></p>
          <pre data-for="cs">class LocaleManager
  constructor: (locale_identifier, @translations_by_locale) ->
    @current_locale = ko.observable()
    @setLocale(locale_identifier)

  get: (string_id) ->
    return '(no translation)' unless @translations_by_locale[@current_locale()]
    return '(no translation)' unless @translations_by_locale[@current_locale()].hasOwnProperty(string_id)

    string = @translations_by_locale[@current_locale()][string_id]
    return string if arguments == 1     # no arguments

    # add arguments
    string = string.replace("{#{index}}", arg) for arg, index in Array.prototype.slice.call(arguments, 1)
    return string

  getLocale: -> return @current_locale()
  setLocale: (locale_identifier) ->
    @current_locale(locale_identifier)
    @trigger('change', @)
    @trigger("change:#{key}", value) for key, value of @translations_by_locale[@current_locale()]

  getLocales: ->
    locales = []
    locales.push(string_id) for string_id, value of @translations_by_locale
    return locales

_.extend(LocaleManager.prototype, Backbone.Events)</pre>
          <pre data-for="js">var LocaleManager = function() {
  this.translations_by_locale = translations_by_locale;
  this.current_locale = ko.observable(locale_identifier);

  this.get = function(string_id) {
    if (!this.translations_by_locale[this.current_locale()]) { return '(no translation)'; }
    if (!this.translations_by_locale[this.current_locale()].hasOwnProperty(string_id)) { return '(no translation)'; }

    var string = this.translations_by_locale[this.current_locale()][string_id];
    if (arguments === 1) { return string; }     // no arguments

    // add arguments
    arguments = Array.prototype.slice.call(arguments, 1);
    for (var index = _i = 0; _i < arguments.length; index = ++_i) {
      string = string.replace("{" + index + "}", arguments[index]);
    }
    return string;
  };

  this.getLocale = function() { return this.current_locale(); };
  this.setLocale = function(locale_identifier) {
    this.current_locale(locale_identifier);
    this.trigger('change', this);
    var map = this.translations_by_locale[this.current_locale()];
    for (key in map) {
      this.trigger("change:" + key, map[key]);
    }
  };

  this.getLocales = function() {
    var locales = [];
    for (var string_id in this.translations_by_locale) {
      value = this.translations_by_locale[string_id];
      locales.push(string_id);
    }
    return locales;
  };
};

_.extend(LocaleManager.prototype, Backbone.Events);
</pre>
          <p></p>
          <h3>Bulk Localized Form Labels</h3>
          <p></p>
          <p><span>If you need to create a large number of localized labels, you could use</span><a href="doc/classes/kb/ViewModel.html"> kb.ViewModel</a><span> like:</span></p>
          <div class="row-fluid">
            <div class="span8">
              <ul class="nav nav-tabs">
                <li class="active"><a href="#lm_bulk_labels_view" data-toggle="tab">View (HTML)</a></li>
                <li><a href="#lm_bulk_labels_view_model" data-toggle="tab">ViewModel (CS/JS)</a></li>
              </ul>
              <div class="tab-content">
                <div id="lm_bulk_labels_view" class="tab-pane active">
                  <pre>&lt;div id='lm_bulk_labels'&gt;
  &lt;!-- ko foreach:['name', 'start_date', 'end_date'] --&gt;
  &lt;p&gt;
    &lt;span data-bind=&quot;text: $parent.labels[$data]&quot;&gt;&lt;/span&gt;
    &lt;span data-bind=&quot;text: $parent[$data]&quot;&gt;&lt;/span&gt;
  &lt;/p&gt;
  &lt;!-- /ko --&gt;

  &lt;p&gt;
    &lt;span&gt;Current Locale: &lt;span&gt;
    &lt;span data-bind=&quot;text: bulk_locale_manager.getLocale()&quot;&gt;&lt;span&gt;
  &lt;/p&gt;
  &lt;button data-bind=&quot;click: toggleLocale&quot;&gt;Toggle Locale&lt;/button&gt;
&lt;/div&gt;</pre>
                </div>
                <div id="lm_bulk_labels_view_model" class="tab-pane">
                  <pre data-for="cs">bulk_locale_manager = new LocaleManager('en', {
  'en':
    name: 'Name: '
    start_date: 'Start Date: '
    end_date: 'End Date: '
  'fr':
    name: 'Nom: '
    start_date: 'Commencement: '
    end_date: 'Clôture: '
})

view_model = kb.viewModel(new Backbone.Model({name: 'Bob', start_date: '1/1/2012', end_date: '1/2/2012'}))

# use ko.observable to create multiple labels quickly
view_model.labels = kb.viewModel(bulk_locale_manager, ['name', 'start_date', 'end_date'])
view_model.toggleLocale = ->
  if (bulk_locale_manager.getLocale() == 'en')
    bulk_locale_manager.setLocale('fr')
  else
    bulk_locale_manager.setLocale('en')

ko.applyBindings(view_model, $('#lm_bulk_labels')[0])</pre>
                  <pre data-for="js">var bulk_locale_manager = new LocaleManager('en', {
  'en': {
    name: 'Name: ',
    start_date: 'Start Date: ',
    end_date: 'End Date: '
  },
  'fr': {
    name: 'Nom: ',
    start_date: 'Commencement: ',
    end_date: 'Clôture: '
  }
});

var view_model = kb.viewModel(new Backbone.Model({
  name: 'Bob',
  start_date: '1/1/2012',
  end_date: '1/2/2012'
}));

// use ko.observable to create multiple labels quickly
view_model.labels = kb.observables(bulk_locale_manager, ['name', 'start_date', 'end_date']);
view_model.toggleLocale = function() {
  if (bulk_locale_manager.getLocale() === 'en') {
    return bulk_locale_manager.setLocale('fr');
  } else {
    return bulk_locale_manager.setLocale('en');
  }
};

ko.applyBindings(view_model, $('#lm_bulk_labels')[0]);
</pre>
                </div>
              </div>
            </div>
            <div class="span4">
              <h4>Live Result</h4>
              <div class="demos_result_box"><div id='lm_bulk_labels'>
  <!-- ko foreach:['name', 'start_date', 'end_date'] -->
  <p>
    <span data-bind="text: $parent.labels[$data]"></span>
    <span data-bind="text: $parent[$data]"></span>
  </p>
  <!-- /ko -->

  <p>
    <span>Current Locale: <span>
    <span data-bind="text: bulk_locale_manager.getLocale()"><span>
  </p>
  <button data-bind="click: toggleLocale">Toggle Locale</button>
</div>
                <script type="application/javascript" src="tutorials/locale_manager/lm_bulk_labels_view_model_bindings.js"></script>
              </div>
            </div>
          </div>
        </section>
      </content>
      <footer class="page">
      </footer>
    </div>
  </body>
</html>